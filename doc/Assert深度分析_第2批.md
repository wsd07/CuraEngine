# BeadingStrategy Assertæ·±åº¦åˆ†æ - ç¬¬2æ‰¹

## ğŸ“ **Assert #5: Line 349 - `assert(!(v0 == to && v1 == from))`**

### **ä»£ç ä½ç½®**
```cpp
Point2LL v0 = VoronoiUtils::p(edge->vertex0());
Point2LL v1 = VoronoiUtils::p(edge->vertex1());
assert(!(v0 == to && v1 == from));
```

### **è§¦å‘æ¡ä»¶**
- Voronoiè¾¹ç¼˜çš„æ–¹å‘ä¸segmentæ–¹å‘å®Œå…¨ç›¸å
- `v0 == to` ä¸” `v1 == from` åŒæ—¶æˆç«‹

### **æ·±å±‚åŸå› åˆ†æ**
1. **Voronoiå›¾æ–¹å‘æ€§é—®é¢˜**:
   - boost::polygonç”Ÿæˆçš„Voronoiè¾¹ç¼˜æ–¹å‘å¯èƒ½ä¸è¾“å…¥segmentæ–¹å‘ç›¸å
   - è¿™åœ¨æ•°å­¦ä¸Šæ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºVoronoiè¾¹ç¼˜çš„æ–¹å‘ç”±ç®—æ³•å†…éƒ¨å†³å®š
2. **åæ ‡ç³»ç»Ÿä¸ä¸€è‡´**:
   - è¾“å…¥segmentä½¿ç”¨çš„åæ ‡ç³»ä¸Voronoiç®—æ³•å†…éƒ¨åæ ‡ç³»å¯èƒ½æœ‰å·®å¼‚
   - åæ ‡å˜æ¢è¿‡ç¨‹ä¸­å¯èƒ½å¼•å…¥æ–¹å‘ç¿»è½¬
3. **æ‹“æ‰‘æ„å»ºé”™è¯¯**:
   - segment cellçš„è¾¹ç¼˜éå†é¡ºåºä¸é¢„æœŸä¸ç¬¦
   - å¯èƒ½æ˜¯ç”±äºè¾“å…¥å¤šè¾¹å½¢çš„é¡¶ç‚¹é¡ºåºï¼ˆé¡ºæ—¶é’ˆvsé€†æ—¶é’ˆï¼‰å¯¼è‡´

### **å‚æ•°èŒƒå›´åˆ†æ**
- **æ­£å¸¸æƒ…å†µ**: 
  - `v0 != to` æˆ– `v1 != from` (è‡³å°‘ä¸€ä¸ªä¸ç›¸ç­‰)
  - è¾¹ç¼˜æ–¹å‘ä¸segmentæ–¹å‘ä¸€è‡´æˆ–éƒ¨åˆ†ä¸€è‡´
- **å¼‚å¸¸æƒ…å†µ**:
  - `v0.X == to.X && v0.Y == to.Y` ä¸” `v1.X == from.X && v1.Y == from.Y`
  - å®Œå…¨çš„æ–¹å‘åè½¬

### **é¢„é˜²æªæ–½**
1. **è¾“å…¥éªŒè¯**: ç¡®ä¿è¾“å…¥å¤šè¾¹å½¢çš„é¡¶ç‚¹é¡ºåºä¸€è‡´
2. **æ–¹å‘æ ‡å‡†åŒ–**: åœ¨æ„å»ºVoronoiå›¾å‰æ ‡å‡†åŒ–segmentæ–¹å‘
3. **å®¹å·®å¤„ç†**: ä½¿ç”¨å°çš„å®¹å·®å€¼è¿›è¡Œåæ ‡æ¯”è¾ƒ

### **ä¿®å¤ç­–ç•¥**
```cpp
CURA_ASSERT_WITH_INFO(!(v0 == to && v1 == from),
    "Segment cellä¸­å‘ç°åå‘è¾¹: segment=(%d,%d)->(%d,%d), edge=(%d,%d)->(%d,%d)",
    from.X, from.Y, to.X, to.Y, v0.X, v0.Y, v1.X, v1.Y);
```

---

## ğŸ“ **Assert #6: Line 896 - Beadè®¡æ•°è¾¹ç•ŒéªŒè¯**

### **ä»£ç ä½ç½®**
```cpp
assert(edge.to_->data_.bead_count_ >= 0 || edge.to_->data_.distance_to_boundary_ == 0);
```

### **è§¦å‘æ¡ä»¶**
- èŠ‚ç‚¹çš„bead_countä¸ºè´Ÿæ•°ï¼Œä½†distance_to_boundaryä¸ä¸º0
- è¡¨ç¤ºbeadè®¡æ•°åˆå§‹åŒ–å¤±è´¥æˆ–è®¡ç®—é”™è¯¯

### **æ·±å±‚åŸå› åˆ†æ**
1. **åˆå§‹åŒ–é¡ºåºé—®é¢˜**:
   - bead_countåœ¨distance_to_boundaryè®¡ç®—å®Œæˆå‰å°±è¢«è®¿é—®
   - åˆå§‹åŒ–å€¼-1æ²¡æœ‰è¢«æ­£ç¡®æ›´æ–°
2. **BeadingStrategyè®¡ç®—å¤±è´¥**:
   - `beading_strategy_.getOptimalBeadCount()`è¿”å›äº†æ— æ•ˆå€¼
   - è¾“å…¥çš„è·ç¦»å€¼è¶…å‡ºäº†ç­–ç•¥çš„æœ‰æ•ˆèŒƒå›´
3. **è¾¹ç•Œæ¡ä»¶å¤„ç†**:
   - åœ¨å¤šè¾¹å½¢è¾¹ç•Œä¸Šçš„èŠ‚ç‚¹å¯èƒ½æœ‰ç‰¹æ®Šçš„å¤„ç†é€»è¾‘
   - distance_to_boundaryä¸º0çš„èŠ‚ç‚¹åº”è¯¥æœ‰æ˜ç¡®çš„bead_countå€¼
4. **æ•°å€¼ç²¾åº¦é—®é¢˜**:
   - æµ®ç‚¹è¿ç®—è¯¯å·®å¯¼è‡´distance_to_boundaryä¸å®Œå…¨ç­‰äº0
   - åº”è¯¥ä½¿ç”¨epsilonå®¹å·®è¿›è¡Œæ¯”è¾ƒ

### **å‚æ•°èŒƒå›´åˆ†æ**
- **æ­£å¸¸æƒ…å†µ**:
  - `bead_count >= 0` (æœ‰æ•ˆçš„beadæ•°é‡)
  - æˆ– `distance_to_boundary == 0` (è¾¹ç•ŒèŠ‚ç‚¹)
- **å¼‚å¸¸æƒ…å†µ**:
  - `bead_count < 0` (é€šå¸¸æ˜¯-1ï¼Œè¡¨ç¤ºæœªåˆå§‹åŒ–)
  - ä¸” `distance_to_boundary > 0` (éè¾¹ç•ŒèŠ‚ç‚¹)
- **è¾¹ç•Œå€¼**:
  - `distance_to_boundary`: é€šå¸¸åœ¨[0, max_distance]èŒƒå›´å†…
  - `bead_count`: é€šå¸¸åœ¨[0, max_beads]èŒƒå›´å†…ï¼Œ-1è¡¨ç¤ºæœªåˆå§‹åŒ–

### **é¢„é˜²æªæ–½**
1. **åˆå§‹åŒ–æ£€æŸ¥**: ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹çš„bead_countéƒ½è¢«æ­£ç¡®åˆå§‹åŒ–
2. **è¾¹ç•Œå®¹å·®**: ä½¿ç”¨epsilonå®¹å·®æ£€æŸ¥distance_to_boundaryæ˜¯å¦ä¸º0
3. **ç­–ç•¥éªŒè¯**: éªŒè¯BeadingStrategyçš„è¾“å…¥èŒƒå›´å’Œè¾“å‡ºæœ‰æ•ˆæ€§

### **ä¿®å¤ç­–ç•¥**
```cpp
const coord_t epsilon = 10; // å®¹å·®å€¼
bool is_boundary = (edge.to_->data_.distance_to_boundary_ <= epsilon);
CURA_ASSERT_WITH_INFO(edge.to_->data_.bead_count_ >= 0 || is_boundary,
    "Beadè®¡æ•°æ— æ•ˆ: bead_count=%d, distance_to_boundary=%d, ä½ç½®=(%d,%d)",
    edge.to_->data_.bead_count_, edge.to_->data_.distance_to_boundary_,
    edge.to_->p_.X, edge.to_->p_.Y);
```

---

## ğŸ“ **Assert #7: Line 1157 - è¿‡æ¸¡æ–¹å‘éªŒè¯**

### **ä»£ç ä½ç½®**
```cpp
assert(start_R < end_R);
```

### **è§¦å‘æ¡ä»¶**
- è¿‡æ¸¡çš„èµ·å§‹åŠå¾„å¤§äºæˆ–ç­‰äºç»“æŸåŠå¾„
- è¿åäº†"ä»å°Rè¿‡æ¸¡åˆ°å¤§R"çš„åŸºæœ¬å‡è®¾

### **æ·±å±‚åŸå› åˆ†æ**
1. **è¾¹ç¼˜æ–¹å‘é”™è¯¯**:
   - è¾¹ç¼˜çš„fromå’ŒtoèŠ‚ç‚¹é¡ºåºä¸é¢„æœŸç›¸å
   - å¯èƒ½æ˜¯ç”±äºåŠè¾¹å›¾æ„å»ºæ—¶çš„æ–¹å‘é—®é¢˜
2. **è·ç¦»è®¡ç®—é”™è¯¯**:
   - `distance_to_boundary_`çš„è®¡ç®—å¯èƒ½æœ‰è¯¯
   - æ•°å€¼ç²¾åº¦é—®é¢˜å¯¼è‡´è·ç¦»å€¼ä¸å‡†ç¡®
3. **ç®—æ³•å‡è®¾è¿å**:
   - generateTransitionMidså‡½æ•°å‡è®¾è¾¹ç¼˜æ€»æ˜¯ä»å†…éƒ¨å‘å¤–éƒ¨å»¶ä¼¸
   - ä½†å®é™…çš„è¾¹ç¼˜å¯èƒ½æœ‰ä¸åŒçš„æ–¹å‘
4. **æ‹“æ‰‘ä¸ä¸€è‡´**:
   - åŠè¾¹å›¾çš„æ‹“æ‰‘ç»“æ„ä¸Voronoiå›¾çš„æ•°å­¦æ€§è´¨ä¸ç¬¦
   - å¯èƒ½å­˜åœ¨å±€éƒ¨çš„æ‹“æ‰‘é”™è¯¯

### **å‚æ•°èŒƒå›´åˆ†æ**
- **æ­£å¸¸æƒ…å†µ**:
  - `start_R < end_R` (ä¸¥æ ¼é€’å¢)
  - é€šå¸¸å·®å€¼åº”è¯¥ > æŸä¸ªæœ€å°é˜ˆå€¼ï¼ˆå¦‚1ä¸ªå•ä½ï¼‰
- **å¼‚å¸¸æƒ…å†µ**:
  - `start_R >= end_R` (ç›¸ç­‰æˆ–é€’å‡)
  - ç‰¹åˆ«æ˜¯ `start_R == end_R` çš„æƒ…å†µéœ€è¦ç‰¹æ®Šå¤„ç†
- **æ•°å€¼èŒƒå›´**:
  - Rå€¼é€šå¸¸åœ¨[0, max_radius]èŒƒå›´å†…
  - å·®å€¼ `end_R - start_R` åº”è¯¥ > epsilon

### **é¢„é˜²æªæ–½**
1. **è¾¹ç¼˜æ–¹å‘éªŒè¯**: åœ¨å¤„ç†å‰éªŒè¯è¾¹ç¼˜çš„æ–¹å‘æ­£ç¡®æ€§
2. **è·ç¦»å•è°ƒæ€§æ£€æŸ¥**: ç¡®ä¿æ²¿è¾¹ç¼˜çš„è·ç¦»æ˜¯å•è°ƒé€’å¢çš„
3. **å®¹å·®å¤„ç†**: å¯¹äºéå¸¸æ¥è¿‘çš„Rå€¼ï¼Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†

### **ä¿®å¤ç­–ç•¥**
```cpp
CURA_ASSERT_WITH_INFO(start_R < end_R,
    "è¿‡æ¸¡æ–¹å‘é”™è¯¯: start_R=%d, end_R=%d, edge=(%d,%d)->(%d,%d), æœŸæœ›start_R < end_R",
    start_R, end_R, edge.from_->p_.X, edge.from_->p_.Y, edge.to_->p_.X, edge.to_->p_.Y);
```

---

## ğŸ“ **Assert #8: Line 1185-1186 - è¿‡æ¸¡ä½ç½®è¾¹ç•Œæ£€æŸ¥**

### **ä»£ç ä½ç½®**
```cpp
coord_t mid_pos = edge_size * (mid_R - start_R) / (end_R - start_R);
assert(mid_pos >= 0);
assert(mid_pos <= edge_size);
```

### **è§¦å‘æ¡ä»¶**
- è®¡ç®—çš„è¿‡æ¸¡ä¸­ç‚¹ä½ç½®è¶…å‡ºè¾¹ç¼˜èŒƒå›´
- `mid_pos < 0` æˆ– `mid_pos > edge_size`

### **æ·±å±‚åŸå› åˆ†æ**
1. **æ’å€¼è®¡ç®—é”™è¯¯**:
   - å…¬å¼ `edge_size * (mid_R - start_R) / (end_R - start_R)` çš„æ•°å­¦å‡è®¾è¢«è¿å
   - è¦æ±‚ `start_R <= mid_R <= end_R` ä¸” `start_R < end_R`
2. **é™¤é›¶é£é™©**:
   - å½“ `end_R == start_R` æ—¶ï¼Œåˆ†æ¯ä¸º0å¯¼è‡´æœªå®šä¹‰è¡Œä¸º
   - è™½ç„¶å‰é¢æœ‰assertæ£€æŸ¥ï¼Œä½†æµ®ç‚¹ç²¾åº¦å¯èƒ½å¯¼è‡´é—®é¢˜
3. **mid_RèŒƒå›´é”™è¯¯**:
   - `mid_R` å¯èƒ½è¶…å‡º `[start_R, end_R]` èŒƒå›´
   - BeadingStrategyè¿”å›çš„è¿‡æ¸¡åŠå¾„å¯èƒ½ä¸åœ¨é¢„æœŸèŒƒå›´å†…
4. **æ•°å€¼ç²¾åº¦ç´¯ç§¯**:
   - å¤šæ¬¡æµ®ç‚¹è¿ç®—çš„ç´¯ç§¯è¯¯å·®
   - å¯èƒ½å¯¼è‡´è½»å¾®çš„è¾¹ç•Œæº¢å‡º

### **å‚æ•°èŒƒå›´åˆ†æ**
- **æ­£å¸¸æƒ…å†µ**:
  - `0 <= mid_pos <= edge_size`
  - `start_R <= mid_R <= end_R`
  - `end_R > start_R` (ä¸¥æ ¼å¤§äº)
- **å¼‚å¸¸æƒ…å†µ**:
  - `mid_pos < 0`: è¡¨ç¤º `mid_R < start_R`
  - `mid_pos > edge_size`: è¡¨ç¤º `mid_R > end_R`
  - åˆ†æ¯æ¥è¿‘0: `|end_R - start_R| < epsilon`
- **æ•°å€¼è¾¹ç•Œ**:
  - `edge_size`: é€šå¸¸ > 0ï¼Œè¡¨ç¤ºè¾¹ç¼˜é•¿åº¦
  - `mid_R`: åº”è¯¥åœ¨ `[start_R, end_R]` èŒƒå›´å†…

### **é¢„é˜²æªæ–½**
1. **èŒƒå›´éªŒè¯**: åœ¨è®¡ç®—å‰éªŒè¯æ‰€æœ‰Rå€¼çš„èŒƒå›´å…³ç³»
2. **é™¤é›¶æ£€æŸ¥**: ç¡®ä¿åˆ†æ¯ä¸ä¸º0æˆ–æ¥è¿‘0
3. **ç²¾åº¦æ§åˆ¶**: ä½¿ç”¨é€‚å½“çš„æ•°å€¼ç²¾åº¦å’Œèˆå…¥ç­–ç•¥

### **ä¿®å¤ç­–ç•¥**
```cpp
const coord_t epsilon = 1;
CURA_ASSERT_WITH_INFO(end_R > start_R + epsilon,
    "è¿‡æ¸¡åŠå¾„èŒƒå›´å¤ªå°: start_R=%d, end_R=%d, diff=%d",
    start_R, end_R, end_R - start_R);

coord_t mid_pos = edge_size * (mid_R - start_R) / (end_R - start_R);
CURA_ASSERT_WITH_INFO(mid_pos >= -epsilon && mid_pos <= edge_size + epsilon,
    "è¿‡æ¸¡ä½ç½®è¶…å‡ºè¾¹ç¼˜: mid_pos=%d, edge_size=%d, mid_R=%d, start_R=%d, end_R=%d",
    mid_pos, edge_size, mid_R, start_R, end_R);
```

---

## ğŸ“Š **ç¬¬2æ‰¹æ€»ç»“**

æœ¬æ‰¹åˆ†æäº†4ä¸ªå…³é”®assertï¼Œæ¶µç›–äº†ï¼š
- **æ–¹å‘ä¸€è‡´æ€§éªŒè¯** (Assert #5)
- **Beadè®¡æ•°æœ‰æ•ˆæ€§** (Assert #6)
- **è¿‡æ¸¡æ–¹å‘æ­£ç¡®æ€§** (Assert #7)
- **æ•°å€¼è®¡ç®—è¾¹ç•Œ** (Assert #8)

### **å…±åŒæ¨¡å¼**
1. **æ•°å€¼ç²¾åº¦**: æµ®ç‚¹è¿ç®—çš„ç´¯ç§¯è¯¯å·®æ˜¯å¸¸è§é—®é¢˜
2. **è¾¹ç•Œæ¡ä»¶**: è¾¹ç•Œå€¼å’Œç‰¹æ®Šæƒ…å†µéœ€è¦ç‰¹æ®Šå¤„ç†
3. **æ–¹å‘æ€§**: å‡ ä½•å¯¹è±¡çš„æ–¹å‘ä¸€è‡´æ€§è‡³å…³é‡è¦
4. **èŒƒå›´éªŒè¯**: æ‰€æœ‰è®¡ç®—ç»“æœéƒ½éœ€è¦èŒƒå›´æ£€æŸ¥

### **å…³é”®æ´å¯Ÿ**
1. **å®¹å·®ä½¿ç”¨**: å‡ ä¹æ‰€æœ‰çš„ç›¸ç­‰æ¯”è¾ƒéƒ½åº”è¯¥ä½¿ç”¨epsilonå®¹å·®
2. **å‰ç½®æ¡ä»¶**: æ¯ä¸ªè®¡ç®—éƒ½æœ‰éšå«çš„å‰ç½®æ¡ä»¶éœ€è¦éªŒè¯
3. **é”™è¯¯ä¼ æ’­**: ä¸€ä¸ªå°çš„æ•°å€¼è¯¯å·®å¯èƒ½å¯¼è‡´åç»­è®¡ç®—å…¨éƒ¨å¤±æ•ˆ
4. **è°ƒè¯•ä¿¡æ¯**: è¯¦ç»†çš„å‚æ•°å€¼å¯¹äºé—®é¢˜è¯Šæ–­è‡³å…³é‡è¦

### **ä¸‹ä¸€æ‰¹é¢„å‘Š**
ç¬¬3æ‰¹å°†åˆ†æAssert #9-12ï¼Œé‡ç‚¹å…³æ³¨ï¼š
- è¿‡æ¸¡åºåˆ—çš„æ’åºå’Œä¸€è‡´æ€§
- èŠ‚ç‚¹beadingæ•°æ®çš„å®Œæ•´æ€§
- å‡ ä½•æ’å€¼çš„æ•°å€¼ç¨³å®šæ€§
- å·¥å…·è·¯å¾„ç”Ÿæˆçš„çº¦æŸæ¡ä»¶
