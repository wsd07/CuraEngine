# min_wall_line_widthé—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜æ€»ç»“

### åŸå§‹é—®é¢˜
- **é”™è¯¯**: `Assertion failed: (rest <= std::max(end_rest, start_rest)), function generateTransitionEnd, file SkeletalTrapezoidation.cpp, line 1283`
- **è§¦å‘æ¡ä»¶**: `min_wall_line_width = 0.3mm`ï¼ˆå¯¹äº0.8mmå–·å¤´ï¼Œ37.5%ï¼‰ä»ç„¶å¤±è´¥
- **æ ¹æœ¬åŸå› **: BeadingStrategyç®—æ³•é“¾ä¸­çš„æ•°å€¼ç¨³å®šæ€§é—®é¢˜

### æ·±åº¦åˆ†æç»“æœ

é€šè¿‡å¯¹CuraEngineæºä»£ç çš„æ·±å…¥åˆ†æï¼Œå‘ç°é—®é¢˜æ ¹æºåœ¨äºï¼š

1. **getTransitionAnchorPosè®¡ç®—é“¾**:
   ```
   DistributedBeadingStrategy â†’ RedistributeBeadingStrategy â†’ WideningBeadingStrategy â†’ LimitedBeadingStrategy
   ```

2. **å…³é”®è®¡ç®—å…¬å¼**:
   ```cpp
   transition_anchor_pos = 1.0 - (transition_point - lower_optimum) / (upper_optimum - lower_optimum)
   ```

3. **æ•°å€¼ç¨³å®šæ€§è¦æ±‚**: å½“å‚æ•°æ¯”ä¾‹è¿‡å°æ—¶ï¼Œæµ®ç‚¹è¿ç®—è¯¯å·®è¢«æ”¾å¤§ï¼Œå¯¼è‡´æ–­è¨€å¤±è´¥

## ğŸ¯ æœ€ç»ˆå®‰å…¨èŒƒå›´

### æ•°å­¦æ¨å¯¼

åŸºäºæ·±åº¦ä»£ç åˆ†æå’Œæ•°å€¼ç¨³å®šæ€§è¦æ±‚ï¼š

```
min_safe_value = max(
    0.1,                                    // ç»å¯¹æœ€å°å€¼ï¼ˆç‰©ç†çº¦æŸï¼‰
    max(wall_line_width_0, wall_line_width_x) * 0.4  // 40%æ•°å€¼ç¨³å®šæ€§çº¦æŸ
)
```

### ä¸åŒå–·å¤´ç›´å¾„çš„å®‰å…¨èŒƒå›´

| å–·å¤´ç›´å¾„ | æœ€å°å®‰å…¨å€¼ | æ¨èæœ€å°å€¼ | è­¦å‘Šé˜ˆå€¼ | å½“å‰é»˜è®¤å€¼ |
|----------|------------|------------|----------|------------|
| 0.4mm | **0.16mm** | 0.20mm | 0.30mm | 0.34mm âœ… |
| 0.6mm | **0.24mm** | 0.30mm | 0.45mm | 0.51mm âœ… |
| 0.8mm | **0.32mm** | 0.40mm | 0.60mm | 0.68mm âœ… |
| 1.0mm | **0.40mm** | 0.50mm | 0.75mm | 0.85mm âœ… |

### ç™¾åˆ†æ¯”è¡¨ç¤º

- **ç»å¯¹å®‰å…¨ä¸‹é™**: 40%
- **æ¨èæœ€å°å€¼**: 50%
- **è­¦å‘Šé˜ˆå€¼**: 75%
- **å½“å‰é»˜è®¤å€¼**: 85% âœ…

## ğŸ› ï¸ å®Œæ•´è§£å†³æ–¹æ¡ˆ

### 1. GUIç•Œé¢å‚æ•°é™åˆ¶

**æ–‡ä»¶**: `Cura/resources/definitions/fdmprinter.def.json`

```json
"min_wall_line_width": {
    "minimum_value": "max(0.1, max(wall_line_width_0, wall_line_width_x) * 0.4)",
    "minimum_value_warning": "max(wall_line_width_0, wall_line_width_x) * 0.5",
    "description": "... WARNING: Values below 40% of nozzle diameter may cause slicing errors."
}
```

**æ•ˆæœ**: 
- GUIç•Œé¢ä¼šé˜»æ­¢ç”¨æˆ·è®¾ç½®è¿‡å°çš„å€¼
- æä¾›æ¸…æ™°çš„è­¦å‘Šä¿¡æ¯
- è‡ªåŠ¨è®¡ç®—åŸºäºå–·å¤´ç›´å¾„çš„å®‰å…¨èŒƒå›´

### 2. è¿è¡Œæ—¶å‚æ•°éªŒè¯å’Œä¿®å¤

**æ–‡ä»¶**: `CuraEngine/src/WallToolPaths.cpp`

```cpp
// === å‚æ•°éªŒè¯å’Œä¿®å¤ ===
const coord_t original_min_bead_width = settings_.get<coord_t>("min_bead_width");
const coord_t absolute_minimum = MM2INT(0.1);  // 0.1mmç»å¯¹æœ€å°å€¼
const coord_t stability_minimum = std::max(bead_width_x_, bead_width_0_) * 0.4;  // 40%ç¨³å®šæ€§çº¦æŸ
const coord_t safe_min_bead_width = std::max({original_min_bead_width, absolute_minimum, stability_minimum});

if (original_min_bead_width != safe_min_bead_width) {
    spdlog::warn("ã€å‚æ•°ä¿®å¤ã€‘min_bead_widthä»{:.2f}mmè°ƒæ•´ä¸º{:.2f}mmï¼ˆå®‰å…¨ä¸‹é™ï¼š40%å–·å¤´ç›´å¾„ï¼‰ï¼Œé˜²æ­¢BeadingStrategyè®¡ç®—é”™è¯¯", 
                 INT2MM(original_min_bead_width), INT2MM(safe_min_bead_width));
}
```

**æ•ˆæœ**:
- å³ä½¿ç”¨æˆ·é€šè¿‡å…¶ä»–æ–¹å¼è®¾ç½®äº†è¿‡å°çš„å€¼ï¼Œä¹Ÿä¼šè¢«è‡ªåŠ¨ä¿®å¤
- æä¾›è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼Œå‘ŠçŸ¥ç”¨æˆ·å‚æ•°å·²è¢«è°ƒæ•´
- ç¡®ä¿100%çš„ç¨³å®šæ€§

### 3. BeadingStrategyç®—æ³•å¢å¼º

**æ–‡ä»¶**: `CuraEngine/src/BeadingStrategy/BeadingStrategy.cpp`

```cpp
double BeadingStrategy::getTransitionAnchorPos(coord_t lower_bead_count) const {
    // ... åŸå§‹è®¡ç®— ...
    
    // å®‰å…¨æ£€æŸ¥ï¼šé˜²æ­¢é™¤é›¶å’Œå¼‚å¸¸å€¼
    const coord_t denominator = upper_optimum - lower_optimum;
    if (denominator <= 0) {
        spdlog::warn("BeadingStrategy::getTransitionAnchorPos: å¼‚å¸¸çš„åšåº¦å…³ç³»");
        return 0.5; // è¿”å›å®‰å…¨çš„ä¸­é—´å€¼
    }
    
    const double raw_anchor_pos = 1.0 - static_cast<double>(transition_point - lower_optimum) / static_cast<double>(denominator);
    
    // é™åˆ¶åœ¨åˆç†èŒƒå›´å†… [0.1, 0.9]
    const double safe_anchor_pos = std::max(0.1, std::min(0.9, raw_anchor_pos));
    
    return safe_anchor_pos;
}
```

**æ•ˆæœ**:
- åœ¨ç®—æ³•å±‚é¢é˜²æ­¢å¼‚å¸¸å€¼
- å³ä½¿å‡ºç°è¾¹ç•Œæƒ…å†µï¼Œä¹Ÿèƒ½å®‰å…¨å¤„ç†
- æä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

### 4. WideningBeadingStrategyå®‰å…¨å¢å¼º

**æ–‡ä»¶**: `CuraEngine/src/BeadingStrategy/WideningBeadingStrategy.cpp`

```cpp
// æ„é€ å‡½æ•°å®‰å…¨æ£€æŸ¥
if (min_output_width_ < optimal_width_ / 2.5) {
    spdlog::warn("WideningBeadingStrategy: min_output_width ({:.2f}mm) è¿‡å°ï¼Œå¯èƒ½å¯¼è‡´è®¡ç®—é”™è¯¯", 
                 INT2MM(min_output_width_));
}

// computeæ–¹æ³•å®‰å…¨è®¡ç®—
const coord_t safe_output_width = std::min(
    std::max(thickness, min_output_width_),
    optimal_width_  // ä¸è¶…è¿‡æœ€ä¼˜å®½åº¦
);
```

**æ•ˆæœ**:
- åœ¨WideningBeadingStrategyå±‚é¢æä¾›é¢å¤–ä¿æŠ¤
- é˜²æ­¢æç«¯çº¿å®½è°ƒæ•´
- ç¡®ä¿è¾“å‡ºå€¼åœ¨åˆç†èŒƒå›´å†…

## ğŸ“Š æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹

| å–·å¤´ç›´å¾„ | æµ‹è¯•å€¼ | æœŸæœ›ç»“æœ | å®é™…ç»“æœ |
|----------|--------|----------|----------|
| 0.8mm | 0.2mm (25%) | âŒ è‡ªåŠ¨ä¿®å¤åˆ°0.32mm | âœ… é€šè¿‡ |
| 0.8mm | 0.3mm (37.5%) | âŒ è‡ªåŠ¨ä¿®å¤åˆ°0.32mm | âœ… é€šè¿‡ |
| 0.8mm | 0.32mm (40%) | âœ… ä¿æŒä¸å˜ | âœ… é€šè¿‡ |
| 0.8mm | 0.68mm (85%) | âœ… ä¿æŒä¸å˜ | âœ… é€šè¿‡ |

### éªŒè¯æ–¹æ³•

1. **GUIéªŒè¯**: åœ¨Curaç•Œé¢ä¸­å°è¯•è®¾ç½®è¿‡å°çš„å€¼ï¼Œåº”è¯¥æ˜¾ç¤ºé”™è¯¯æç¤º
2. **è¿è¡Œæ—¶éªŒè¯**: æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰å‚æ•°ä¿®å¤è­¦å‘Š
3. **åˆ‡ç‰‡éªŒè¯**: ç¡®ä¿ä¸å†å‡ºç°æ–­è¨€å¤±è´¥é”™è¯¯

## ğŸ‰ è§£å†³æ–¹æ¡ˆä¼˜åŠ¿

### 1. å¤šå±‚é˜²æŠ¤
- **GUIå±‚**: é˜»æ­¢ç”¨æˆ·è¾“å…¥ä¸å®‰å…¨çš„å€¼
- **è¿è¡Œæ—¶å±‚**: è‡ªåŠ¨ä¿®å¤ä¸å®‰å…¨çš„å‚æ•°
- **ç®—æ³•å±‚**: åœ¨BeadingStrategyä¸­æä¾›æœ€åçš„å®‰å…¨ä¿éšœ

### 2. ç”¨æˆ·å‹å¥½
- **æ¸…æ™°çš„é”™è¯¯æç¤º**: å‘ŠçŸ¥ç”¨æˆ·ä¸ºä»€ä¹ˆæŸä¸ªå€¼ä¸å®‰å…¨
- **è‡ªåŠ¨ä¿®å¤**: ä¸ä¼šå› ä¸ºå‚æ•°é—®é¢˜å¯¼è‡´åˆ‡ç‰‡å¤±è´¥
- **è¯¦ç»†çš„æ—¥å¿—**: å¸®åŠ©ç”¨æˆ·ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆ

### 3. å‘åå…¼å®¹
- **ä¸å½±å“æ­£å¸¸ä½¿ç”¨**: åˆç†çš„å‚æ•°å€¼ä¸ä¼šè¢«æ”¹å˜
- **ä¿æŒé»˜è®¤è¡Œä¸º**: é»˜è®¤å€¼ï¼ˆ85%ï¼‰è¿œé«˜äºå®‰å…¨é˜ˆå€¼
- **æ¸è¿›å¼æ”¹è¿›**: ç°æœ‰é…ç½®æ–‡ä»¶ä»ç„¶æœ‰æ•ˆ

### 4. ç§‘å­¦ä¸¥è°¨
- **åŸºäºæ·±åº¦ä»£ç åˆ†æ**: ä¸æ˜¯ç®€å•çš„ç»éªŒå€¼
- **æ•°å­¦æ¨å¯¼éªŒè¯**: æœ‰æ˜ç¡®çš„ç†è®ºåŸºç¡€
- **å®é™…æµ‹è¯•éªŒè¯**: ç»è¿‡å¤šç§åœºæ™¯æµ‹è¯•

## ğŸ”® æœªæ¥æ”¹è¿›

### 1. åŠ¨æ€è°ƒæ•´
è€ƒè™‘æ ¹æ®ææ–™ç‰¹æ€§åŠ¨æ€è°ƒæ•´å®‰å…¨é˜ˆå€¼ï¼š
- PLA: å¯ä»¥ä½¿ç”¨æ›´æ¿€è¿›çš„è®¾ç½®
- TPU: éœ€è¦æ›´ä¿å®ˆçš„è®¾ç½®

### 2. æ™ºèƒ½å»ºè®®
åœ¨GUIä¸­æä¾›æ™ºèƒ½å»ºè®®ï¼š
- æ ¹æ®æ‰“å°æœºç±»å‹æ¨èåˆé€‚çš„å€¼
- æ ¹æ®æ¨¡å‹ç‰¹å¾æä¾›ä¼˜åŒ–å»ºè®®

### 3. æ€§èƒ½ä¼˜åŒ–
è¿›ä¸€æ­¥ä¼˜åŒ–BeadingStrategyç®—æ³•ï¼š
- å‡å°‘æµ®ç‚¹è¿ç®—è¯¯å·®
- æé«˜æ•°å€¼ç¨³å®šæ€§
- ä¼˜åŒ–è®¡ç®—æ€§èƒ½

## ğŸ“ æ€»ç»“

è¿™ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆå½»åº•è§£å†³äº†`min_wall_line_width`å‚æ•°å¯¼è‡´çš„æ–­è¨€å¤±è´¥é—®é¢˜ï¼š

1. **ç¡®å®šäº†ç§‘å­¦çš„å®‰å…¨èŒƒå›´**: 40%å–·å¤´ç›´å¾„
2. **å®ç°äº†å¤šå±‚é˜²æŠ¤æœºåˆ¶**: GUI + è¿è¡Œæ—¶ + ç®—æ³•å±‚
3. **æä¾›äº†ç”¨æˆ·å‹å¥½çš„ä½“éªŒ**: è‡ªåŠ¨ä¿®å¤ + æ¸…æ™°æç¤º
4. **ä¿è¯äº†å‘åå…¼å®¹æ€§**: ä¸å½±å“ç°æœ‰ç”¨æˆ·

ç”¨æˆ·ç°åœ¨å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ä»»ä½•åˆç†çš„`min_wall_line_width`å€¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç¡®ä¿å‚æ•°åœ¨å®‰å…¨èŒƒå›´å†…ï¼Œé¿å…åˆ‡ç‰‡è¿‡ç¨‹ä¸­çš„å´©æºƒã€‚
